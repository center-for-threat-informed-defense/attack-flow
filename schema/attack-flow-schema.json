{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://mitre-engenuity.com/schema/attack-flow/2021-10-13-draft.json",
    "title": "Attack Flow",
    "description": "This schema describes the Attack Flow JSON format.",
    "type": "object",
    "properties": {
        "type": {
            "description": "Indicate whether this is an attack flow or an attack flow pattern",
            "type": "string",
            "enum": ["attack-flow", "attack-flow-pattern"]
        },
        "id": {
            "description": "UUID for this attack flow or pattern.",
            "type": "string",
            "pattern": "^[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}$"
        },
        "created": {
            "description": "Creation time in RFC-3339 format (e.g. YYYY-MM-DDThh:mm:ssZ)",
            "type": "string",
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{1,})?(Z|[+-]\\d{2}:\\d{2})$"
        },
        "author": {
            "description": "The author of the attack flow",
            "type": "string"
        },
        "actions": {
            "description": "The list of action nodes in the attack flow",
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "id": {
                        "description": "UUID for this action.",
                        "type": "string",
                        "pattern": "^[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}$"
                    },
                    "name": {
                        "description": "The name of the action. May be an ATT&CK name.",
                        "type": "string"
                    },
                    "description": {
                        "description": "A description of the action.",
                        "type": "string"
                    },
                    "timestamp": {
                        "description": "The timestamp when this action was observed in RFC-3339 format (e.g. YYYY-MM-DDThh:mm:ssZ)",
                        "type": "string",
                        "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{1,})?(Z|[+-]\\d{2}:\\d{2})$"
                    },            
                    "reference": {
                        "description": "A description of the action.",
                        "type": "string"
                    },
                    "properties": {
                        "description": "The list of properties associated with the action.",
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "succeeded": {
                        "description": "TODO",
                        "type": "string"
                    },
                    "confidence": {
                        "description": "TODO",
                        "type": "string"
                    },
                    "state": {
                        "description": "TODO",
                        "type": "string"
                    }
                },
                "required": ["id", "name", "description"]
            }
        },
        "assets": {
            "description": "The list of asset nodes in the attack flow",
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "id": {
                        "description": "UUID for this asset.",
                        "type": "string",
                        "pattern": "^[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}$"
                    },
                    "properties": {
                        "description": "The list of properties associated with the asset.",
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                },
                "required": ["id"]
            }
        },
        "relationships": {
            "description": "The list of relationship edges in the attack flow",
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "id": {
                        "description": "UUID for this relationship.",
                        "type": "string",
                        "pattern": "^[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}$"
                    },
                    "label": {
                        "description": "The type of relationship, e.g. 'modifies'.",
                        "type": "string"
                    },
                    "source": {
                        "description": "UUID of the source action or asset.",
                        "type": "string",
                        "pattern": "^[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}$"
                    },
                    "destination": {
                        "description": "UUID of the destination action or asset.",
                        "type": "string",
                        "pattern": "^[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}$"
                    }
                },
                "required": ["id", "label", "source", "destination"]
            }
        }
    },
    "additionalProperties": true,
    "required": [ 
        "type", 
        "id", 
        "name", 
        "created", 
        "actions", 
        "assets", 
        "relationships" 
    ]
}