# Attack Flow Format

Attack Flow represents the linkage of adversary behavior for a given attack flow .

The type, description, and required attributes of each field are provided in the subsequent sections along with an example.

TODO: Visual for the Attack Flow model / Data Dictionary.

*Entity Diagram for Attack Flow Format*

## TODOs / Open Items
1. How should we capture detailed Action/Asset information?
   1. Adversary Emulation plan properties in https://github.com/center-for-threat-informed-defense/adversary_emulation_library
   2. Incident Reports

## Rules
These are rules that cannot be captured in JSON schema.
1. Relationships must be compliant with OWL (https://www.w3.org/OWL/)
2. See the Relationships Table for valid Attack Flow relationships

## Data Dictionary

<!--JSON_SCHEMA Generated by `generate_schema_docs.py` at 2021-11-02T13:25:59.283765Z-->
<h3 id="TopLevelMetadata">Top Level Metadata Fields</h3>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Required</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>flow</td>
    <td><a href="#flow">flow</a> object</td>
    <td>Yes</td>
    <td>An Attack Flow Meta object</td>
  </tr>
  <tr>
    <td>actions</td>
    <td>array of <a href="#actions">actions</a></td>
    <td>No</td>
    <td>The list of action nodes in the attack flow</td>
  </tr>
  <tr>
    <td>assets</td>
    <td>array of <a href="#assets">assets</a></td>
    <td>No</td>
    <td>The list of asset nodes in the attack flow</td>
  </tr>
  <tr>
    <td>relationships</td>
    <td>array of <a href="#relationships">relationships</a></td>
    <td>No</td>
    <td>The list of relationship edges in the attack flow. All Actions MUST have a relationship to the flow.</td>
  </tr>
  <tr>
    <td>properties</td>
    <td>array of <a href="#properties">properties</a></td>
    <td>No</td>
    <td>Properties of actions or assets</td>
  </tr>
</table>

<h3 id="flow">Flow Fields</h3>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Required</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>type</td>
    <td>enum</td>
    <td>Yes</td>
    <td>Indicate that this is an Attack Flow. (Enum values: "attack-flow")</td>
  </tr>
  <tr>
    <td>id</td>
    <td>uri</td>
    <td>Yes</td>
    <td>The identifier for this Attack Flow. MUST be unique within this document. TODO: Ideally is unique among Attack Flows produced by a particular organization.</td>
  </tr>
  <tr>
    <td>name</td>
    <td>string</td>
    <td>Yes</td>
    <td>The name of the Attack Flow.</td>
  </tr>
  <tr>
    <td>created</td>
    <td>date-time</td>
    <td>Yes</td>
    <td>Creation time of the Attack Flow. (RFC-3339 format, e.g. YYYY-MM-DDThh:mm:ssZ)</td>
  </tr>
  <tr>
    <td>author</td>
    <td>string</td>
    <td>No</td>
    <td>The author of the Attack Flow.</td>
  </tr>
  <tr>
    <td>description</td>
    <td>string</td>
    <td>No</td>
    <td>The description of the Attack Flow.</td>
  </tr>
</table>

<h3 id="actions">Actions Fields</h3>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Required</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>id</td>
    <td>uri</td>
    <td>Yes</td>
    <td>The identifier for this Action. MUST be unique within this document.</td>
  </tr>
  <tr>
    <td>type</td>
    <td>enum</td>
    <td>No</td>
    <td>Indicate that this is an Action (Enum values: "action")</td>
  </tr>
  <tr>
    <td>name</td>
    <td>string</td>
    <td>Yes</td>
    <td>The name of the action. May be an ATT&amp;CK technique name.</td>
  </tr>
  <tr>
    <td>description</td>
    <td>string</td>
    <td>Yes</td>
    <td>A description of the action.</td>
  </tr>
  <tr>
    <td>timestamp</td>
    <td>date-time</td>
    <td>No</td>
    <td>The timestamp when this action was observed. (RFC-3339 format, e.g. YYYY-MM-DDThh:mm:ssZ)</td>
  </tr>
  <tr>
    <td>reference</td>
    <td>string</td>
    <td>No</td>
    <td>A reference for the action. May be a URL to an ATT&amp;CK technique.</td>
  </tr>
  <tr>
    <td>succeeded</td>
    <td>number</td>
    <td>No</td>
    <td>Float from 0 (failed) to 1 (succeeded) or distribution representing the probability that action succeeded in its effects. Any effects which may be separable should be defined through a separate action. Assumed to be 1 (100% ~ TRUE) if not included.</td>
  </tr>
  <tr>
    <td>confidence</td>
    <td>number</td>
    <td>No</td>
    <td>Float from 0 to 1 or distribution representing the confidence that the action succeeded. Assumed to be 1 (100% ~ ground truth) if not included.</td>
  </tr>
  <tr>
    <td>logic_operator_language</td>
    <td>string</td>
    <td>No</td>
    <td>The language of the logic_operator. Defaults to flow-vTBD when left blank.</td>
  </tr>
  <tr>
    <td>logic_operator</td>
    <td>string</td>
    <td>Yes</td>
    <td>The logic_operator may be any logic valid in the language defined by the logic_operator_language. If the logic_operator_language is undefined, the logic_operator may be AND or OR, representing the relative operation on all required-by relationships. The logic_operator must return the state changes to the provides relationships. Inputs to the logic_operator are required-by Assets and their states; outputs of the logic_operator are provides Assets and their states updates.</td>
  </tr>
</table>

<h3 id="assets">Assets Fields</h3>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Required</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>id</td>
    <td>uri</td>
    <td>Yes</td>
    <td>The identifier for this Asset. MUST be unique within this document.</td>
  </tr>
  <tr>
    <td>type</td>
    <td>enum</td>
    <td>No</td>
    <td>Indicate that this is an Asset (Enum values: "asset")</td>
  </tr>
  <tr>
    <td>state</td>
    <td>string</td>
    <td>No</td>
    <td>A property that may be used as a transient string representing the state of the object during a point in time representing the current state of the system. The sum of all object states is the state of the system. This may be as simple as &quot;compromised&quot;, the Confidentiality, Integrity, Availability triad, DIMFUI (Degradation, Interruption, Modification, Fabrication, Unauthorized Use, and Interception), or it may even be an arbitrary string. If not included, it is assumed that the state is &#x27;compromised&#x27; after a parent action succeeds.</td>
  </tr>
</table>

<h3 id="relationships">Relationships Fields</h3>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Required</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>source</td>
    <td>uri</td>
    <td>Yes</td>
    <td>The source flow, action, or asset for this relationship.</td>
  </tr>
  <tr>
    <td>type</td>
    <td>uri</td>
    <td>Yes</td>
    <td>The type of relationship.</td>
  </tr>
  <tr>
    <td>target</td>
    <td>string</td>
    <td>Yes</td>
    <td>The target asset, action, or property. If the target is an Action, the source MUST be an Asset. If the target is an Asset, the source MUST be an Action.</td>
  </tr>
</table>

<h3 id="properties">Properties Fields</h3>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Required</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>type</td>
    <td>uri</td>
    <td>Yes</td>
    <td>The type of property.</td>
  </tr>
  <tr>
    <td>source</td>
    <td>string</td>
    <td>Yes</td>
    <td>The source action or asset for this property.</td>
  </tr>
  <tr>
    <td>target</td>
    <td>string</td>
    <td>Yes</td>
    <td>The property&#x27;s target.</td>
  </tr>
</table>

<!--/JSON_SCHEMA-->

## Relationships
The following table contains the valid relationships in Attack Flow
<table>
  <tr>
    <th>Source Type</th>
    <th>Target Type</th>
    <th>Valid Relationships</th>
  </tr>
  <tr>
    <td>Asset</td>
    <td>Action</td>
    <td>required-by</td>
  </tr>
  <tr>
    <td>Action</td>
    <td>Asset</td>
    <td>provides</td>
  </tr>
  <tr>
    <td>Action</td>
    <td>Property</td>
    <td>described-by</td>
  </tr>
  <tr>
    <td>Asset</td>
    <td>Property</td>
    <td>described-by</td>
  </tr>
  <tr>
    <td>Asset</td>
    <td>Attack Flow</td>
    <td>flow</td>
  </tr>
  <tr>
    <td>Action</td>
    <td>Attack Flow</td>
    <td>flow</td>
  </tr>
  <tr>
    <td>Property</td>
    <td>Attack Flow</td>
    <td>NOT RECOMMENDED</td>
  </tr>
  <tr>
    <td>Action</td>
    <td>Action</td>
    <td>PROHIBITED</td>
  </tr>
  <tr>
    <td>Asset</td>
    <td>Asset</td>
    <td>PROHIBITED</td>
  </tr>
</table>

## Example Attack Flow
<img src="/data/action-object-tesla.png" width="528px">

*Visualization of Tesla breach*
TODO: Migrate to JSON
```
type: attack-flow
id: attack-flow--00
name: 'Tesla Breach Flow'
version: 1.0
created: 2021-09-29
modified: 2021-09-29
author: Center for Threat-Informed Defense (CTID)
description: Attack Flow for Tesla Breach (2018)
tags:
  - AWS
  - Cloud
  - Containers
  - Kubernetes
  - S3
start-action-id:
  - action--00
comments: >-
  A quick draft using Version 0.2 of the Actions/Objects Model and the Tesla breach described in
  https://www.zdnet.com/article/tesla-systems-used-by-hackers-to-mine-cryptocurrency/
sightings:
  - type: report
    id: report--00
    name: 'Tesla cloud systems exploited by hackers to mine cryptocurrency'
    report_type: campaign
    published: 2018-02-20
    description: >-
      Updated: Researchers have discovered that Tesla's AWS cloud systems were compromised for the
      purpose of cryptojacking.
    external_references: 'https://www.zdnet.com/article/tesla-systems-used-by-hackers-to-mine-cryptocurrency/'
actions:
  - type: action
    id: action--00
    name: 'External Remote Services'
    description: >-
      Adversary accesses unsecured Kubernetes dashboard, gaining administrative console access
    external_references:
      - external_id: T1133
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1133
    x-attack-flow-relative-time: 00:00.000Z
    requirements:
      - object--00
      - object--01
    outputs:
      - object--02
      - object--03
    properties: properties--00
  - type: action
    id: action--01
    name: 'Deploy Container'
    description: >-
      Adversary deploys one/more containers to run cryptomining software
    external_references:
      - external_id: T1610
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1610
    x-attack-flow-relative-time: 01:00.000Z
    requirements:
      - object--02
    outputs:
      - object--04
      - object--05
    properties: properties--01
  - type: action
    id: action--02
    name: 'Resource Hijacking'
    description: >-
      Adversary container(s) run cryptomining software using system resources
    external_references:
      - external_id: T1496
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1496
    x-attack-flow-relative-time: 02:00.000Z
    requirements:
      - object--04
      - object--05
    outputs:
      - object--06
    properties: properties--02
  - type: action
    id: action--03
    name: 'Unsecured Credentials: Credentials in Files'
    description: >-
      Adversary finds AWS credentials stored in accessible Kubernetes cluster secrets
    external_references:
      - external_id: T1552.001
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1552/001
    x-attack-flow-relative-time: 03:00.000Z
    requirements:
      - object--02
      - object--03
    outputs:
      - object--07
    properties: properties--03
  - type: action
    id: action--04
    name: 'Valid Accounts: Cloud Accounts'
    description: >-
      Adversary uses stolen AWS credentials to authenticate to AWS
    external_references:
      - external_id: T1078.004
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1078/004
    x-attack-flow-relative-time: 04:00.000Z
    requirements:
      - object--07
    outputs:
      - object--08
    properties: properties--04
  - type: action
    id: action--05
    name: 'Data from Cloud Storage Object'
    description: >-
      Adversary uses AWS access to collect non-public Tesla information from accessible S3
      bucket(s)
    external_references:
      - external_id: T1530
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1530
    x-attack-flow-relative-time: 05:00.000Z
    requirements:
      - object--08
    outputs:
      - object--09
    properties: properties--05
objects:
  - type: object
    id: object--00
    properties:
  - type: object
    id: object--01
    properties:
  - type: object
    id: object--02
    properties:
  - type: object
    id: object--03
    properties:
  - type: object
    id: object--04
    properties:
  - type: object
    id: object--05
    properties:
  - type: object
    id: object--06
    properties:
  - type: object
    id: object--07
    properties:
  - type: object
    id: object--08
    properties:
  - type: object
    id: object--09
    properties:
```